---
title: "VIetnam Bombing History - Chapter 2"
author: "Ha Pham"
output: html_document
urlcolor: blue
---

```{r setup, include=FALSE, echo=FALSE}
source("config/config_pj.R")
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
thunder = fread("data/processed/bombing_rolling_thunder.csv")
vnmap = readRDS("data/raw/vnmap.rds")
north_map = readRDS("data/raw/north_map.rds")
aircrafts = fread("data/raw/THOR_Vietnam_Aircraft_Glossary.csv")

thunder = thunder[msnym < "1969-01-01"]

replace_missing(thunder)
thunder[, msndate := ymd(msndate)]
thunder[, msnym := ymd(msnym)]
thunder[, delivered_tonnage := weapontypeweight * numweaponsdelivered ]
thunder[, jettisoned_tonnage := weapontypeweight * numweaponsjettisoned]
thunder[, returned_tonnage := weapontypeweight * numweaponsreturned]

```

Rolling Thunder is an interesting operation to investigate, because the bombing strategy changes over time. 

A little bit of background: 

After Geneva conference in 1954, the U.S. replaces France as a political backup for Ngo Dinh Diem in the South Vietnam, as it feared if Vietnam were fall under the influence of communism, all countries around would follow. At first, the U.S. believed that it could grow South Vietnam's government into a self-sustained one. However, by the beginning of 1965, that belief was turned around when they realized that "without further American action, Saigon government could not survive." 

Operation Rolling Thunder was devised as a demonstration of U.S. commitment with Saigon. 

The operation lasted from 02/03/1965 - 02/11/1968. Objectives. 

- Boost Saigon's morale at first, not to directly and severely affect Hanoi. 
- Persuade North Vietnam to stop supporting South Vietnam's communists withouth sending ground force into North Vietnam
- Destroy North Vietnam's transport system, industrial base, air defenses, which in effect will cut off the supporting line from North to South.

What is interesting here is that the U.S. tried to tread on thin ice here. They want to scare North Vietnam off the South, but they did not dare to go for a full-blown air campaign lest China or Soviet would retaliate with their full might. Therefore, their bombing strategy slowly escalated and changed over time, which will reflect to the data.

# Overview

Some numbers first

Delivered tonnage:

```{r}
sum(thunder$delivered_tonnage) %>% comma()
```

Number of aircraft types


```{r}
uniqueN(thunder$aircraft_root)
```



Overview of bombing targets


```{r}

north_center = c(105.5, 20)
# north_map <- ggmap(get_googlemap(center = north_center, scale = 2, zoom = 6, maptype = "roadmap"), extent = "normal")

target_coord <- thunder[mfunc_desc_class == "KINETIC", .(msnyear, mfunc_desc_class, 
                            lon = tgt_lon, 
                            lat = tgt_lat, 
                            milservice)] %>% unique()

force_col = c(
    "USAF" = "dodgerblue4"
    , "USN" = "darkgoldenrod3"
    , "USMC" = "red3"
    , "VNAF" = "royalblue3"
    , "RLAF" = "gray"
    , "RAAF" = "gray"
    , "KAF" = "gray"
    , "USA" = "gray"
)

```


To minimize airspace conflict among air forces, North Vietnam was divided into six target regions called "route packages":

<center> ![](plot/route_packages.gif) </center>

Each region is assigned to one air force or navy, and they are forbidden to intrude each others' regions. The Navy's Carrier Task Force 77 handled operations in RPs 2, 3, 4, and 6B, as these bordered on the Gulf of Tonkin. The Air Force was given RP 1, RP 5, and 6A. We can see this division clearly from the bombing targets:

```{r}
nsample = 5000
edges = round(north_map$data)
    grid_x = seq(edges$lon[1], edges$lon[2], 1)
    grid_y = seq(edges$lat[1], edges$lat[3], 1)
    
target_df <- target_coord %>% 
    filter(
        mfunc_desc_class == "KINETIC"
        , lon >= edges$lon[1],  lon <= edges$lon[2]
        , lat >= edges$lat[1], lat <= edges$lat[3]
        , milservice %in% c("USN", "USAF")
    ) %>% 
    sample_n(nsample)    

label_df = data.table(
    x = c(107.5, 109)
    , y = c(19, 17)
    , label = c("US Navy", "US Air Force")
)

thunder_map = north_map +
    geom_point(data = target_df, aes(x = lon, y = lat, col = milservice), size = 0.1, show.legend = F) +
    geom_vline(xintercept = grid_x, size = 0.1, alpha = 0.7, color = "gray") +
    geom_hline(yintercept = grid_y, size = 0.1, alpha = 0.7, color = "gray") + 
    geom_label(data = label_df[1], aes(x = x, y = y, label = label), col = "white", fill = force_col["USN"]) +
    geom_label(data = label_df[2], aes(x = x, y = y, label = label), col = "white", fill = force_col["USAF"]) +
    scale_color_manual(values = force_col, name = NULL) +
    scale_x_continuous(breaks = grid_x) + 
    scale_y_continuous(breaks = grid_y) + 
    ggtitle("Rolling Thunder Bombing map 1965 - 1968") + 
    labs(x = "", y = "") + 
    theme(
        panel.background = element_blank()
        , axis.ticks = element_blank()
        , axis.line = element_line(size = 0.1, color = "gray")
    ) 
```

```{r, include=TRUE, fig.height=7, fig.width=7, fig.align="center"}

print(thunder_map)

```

Bombing intensity throughout the years

```{r}
month_aggr = thunder[, .(
    total_tonnage = sum(delivered_tonnage)
    , sortie_count = .N
    ), by = .(msnyear, msnmonth = round_date(msndate, "month"))]

ggplot(month_aggr) + 
    geom_line(aes(x = msnmonth, y = total_tonnage))

```


```{r}
ggplot(month_aggr) + 
    geom_line(aes(x = msnmonth, y = sortie_count))

```


We do not have data before Oct 1965, but we can clearly see Hanoi and Hai Phong were bombed less severly because of U.S.' initial hesitation 

```{r, include=TRUE, fig.height=7, fig.width=7, fig.align="center"}
rt65 = plot_bomb_points(north_map, target_coord, 1965, nsample = 2000, plot_title = "Rolling Thunder target map - 1965")

rt65 + 
    annotate("label", x = 108, y = 21, label = "Hanoi & Haiphong\nwere spared", hjust = 0, alpha = 0.8)  + 
    annotate("rect", xmin = 105.5, xmax = 107, ymin = 20.5, ymax = 21.5, alpha = 0.3, size = 15)

```



Density, for better visualization

```{r, include=TRUE, fig.height=7, fig.width=7, fig.align="center"}
plot_bomb_dens_year(north_map, target_coord, 1965, nsample = 2000)
```


```{r, fig.height=7, fig.width=7, fig.align="center"}
plot_bomb_dens_year(north_map, target_coord, year = 1966)
```

```{r, fig.height=7, fig.width=7, fig.align="center"}
plot_bomb_dens_year(north_map, target_coord, year = 1967)
```

```{r, fig.height=7, fig.width=7, fig.align="center"}
plot_bomb_dens_year(north_map, target_coord, year = 1968)
```


# How do bombing target strategy change

```{r}
tgt_dispersion = thunder[, .(
    sd_lat = sd(tgt_lat, na.rm = T)
    , sd_lon = sd(tgt_lon, na.rm = T)
    
    , range_lat = range(tgt_lat, na.rm = T)[2] - range(tgt_lat, na.rm = T)[1]
    , range_lon = range(tgt_lon, na.rm = T)[2] - range(tgt_lon, na.rm = T)[1]
    
    , iqr_lat = IQR(tgt_lat, na.rm = T)
    , iqr_lon = IQR(tgt_lon, na.rm = T)
), by = .(msn_month = round_date(msndate, "month"))]


```

At first latitude's SD is quite large but then drop --> first random by latitude?
at first longitude's SD is small but then increase --> expand target to different regions in 1969?

Rolling Thunder reached the last stage of its operational evolution during 1967 and 1968. The chief purpose of the American air effort in the higher Route Packages of North Vietnam was slowly transformed into that of interdicting the flow of supplies and material and the destruction of those segments of the north's infrastructure that supported its military effort

1966: bomb on higher route packages to scare the north, thus low longitude variation, high latitude (horizontal) variation
1968 onward: bomb lower route packages (panhandle), thus longitude variation increases

```{r}
ggplot(tgt_dispersion[msn_month >= '1966-01-01'], aes(x = msn_month)) + 
    geom_line(aes(y = sd_lat, group = 1), stat = "identity", color = "red") + 
    geom_line(aes(y = sd_lon, group = 1), stat = "identity", color = "blue") 

```


Coordinate ranges (max - min) is lower, which could means more focused bombing.

```{r}
ggplot(tgt_dispersion[msn_month >= '1966-07-01'], aes(x = msn_month)) + 
    geom_line(aes(y = range_lat, group = 1), stat = "identity", color = "red") + 
    geom_line(aes(y = range_lon, group = 1), stat = "identity", color = "blue") 

```

More on this change of bombing strategy later.

# The gradual escalation

Bombing tonnage in Rolling Thunder increases gradually year-by-year and peaked in 1968, which is why it was described as the bloodiest year in this war.

```{r}
tonnage_time = thunder[, .(total_tonnage = sum(delivered_tonnage)), by = .(msnym)]

ggplot(tonnage_time) + 
    geom_line(aes(x = msnym, y = total_tonnage, group = 1)) + 
    scale_x_date(date_breaks = "1 year", date_labels = "%Y")

```


# Mission types

Armed recconaiseanse means using small aircraft formations patrolled highways, railroads, rivers searching for targets of opportunity 

```{r}
mfunc_aggr = thunder[!is.na(mfunc_desc), .(
    sortie_count = .N
    , total_tonnage = sum(delivered_tonnage)
), by = .(mfunc_desc, mfunc_desc_class)]

ggplot(mfunc_aggr[1:10]) + 
    geom_bar(aes(x = reorder(mfunc_desc, sortie_count), y = sortie_count), stat = "identity") + 
    coord_flip()

```



```{r}

mfunc_stats = thunder[!is.na(mfunc_desc), .(
    sortie_count = .N
    , unique_msn_count = uniqueN(missionid)
    , total_delivered = sum(delivered_tonnage)
    , days_happened_count = uniqueN(msndate)
), by = .(mfunc_desc_class, mfunc_desc)]



mfunc_time = thunder[mfunc_desc %in% mfunc_popular, .(
    sortie_count = .N
    , mission_count = uniqueN(missionid)
    , total_delivered = sum(delivered_tonnage)
), by = .(mfunc_desc, msnym, msnyear)]



```

At first there are more armed reccon missions, due to "system to request fixed targets are too complicated". Even in the after years this type of mission is still consistantly used, but the strike missions gradually increased due to the escalating bombing efforts.

```{r}

ggplot(mfunc_time[mfunc_desc %in% c("STRIKE", "ARMED RECCE")]) + 
    geom_line(aes(x = msnym, y = sortie_count, color = mfunc_desc), stat = "identity")

```

# Aircraft use by Military services

Looking at aircraft application, fighter - bomber, fighter, attack aircrafts are used most and delivered the highest tonnage of weapon.

```{r}
# Application color

aircraft_app_ttl = thunder[!is.na(aircraft_application), .(
    count = .N
    , mission_count = uniqueN(missionid)
    , total_tonnage = sum(delivered_tonnage)
    ), by = .(aircraft_application)][order(aircraft_application, -count)]

ggplot(aircraft_app_ttl) + 
    geom_bar(aes(x = reorder(aircraft_application, count), y = count), stat = "identity") + 
    coord_flip()
```

A fighter-bomber is a fighter aircraft that has been modified, or used primarily, as a light bomber or attack aircraft. It differs from bomber and attack aircraft primarily in its origins, as a fighter that has been adapted into other roles,[1] whereas bombers and attack aircraft are developed specifically for bombing and attack roles.

--> Probably because of this versatility that it was used most

For each of these aircraft, BOMB is still the most used weapon. The percentage of air-to-air weapon used by fighter aircrafts is higher than that of bombers.

```{r}
aircraft_wtype_ttl = thunder[!is.na(aircraft_application) & !is.na(weapon_class), .(
    count = .N
    , total_tonnage = sum(delivered_tonnage)
    ), by = .(aircraft_application, weapon_class)][order(aircraft_application, -count)]
aircraft_wtype_ttl[, pct := count / sum(count), by = .(aircraft_application)]

top_application = c("FIGHTER, BOMBER", "FIGHTER", "ATTACK", "CARRIER, FIGHTER", "TACTICAL, BOMBER", "STRATEGIC, BOMBER")

ggplot(aircraft_wtype_ttl[aircraft_application %in% top_application]) + 
    geom_bar(aes(x = aircraft_application, y = pct, fill = weapon_class)
             , position = position_stack(), stat = "identity") + 
    coord_flip()

```

```{r}
aircraft_service_ttl = thunder[!is.na(aircraft_application) & !is.na(milservice), .(
    sortie_count = .N
    , total_tonnage = sum(delivered_tonnage)
    ), by = .(aircraft_application, milservice)]

aircraft_service_ttl[, pct := sortie_count / sum(sortie_count), by = .(aircraft_application)]

ggplot(aircraft_service_ttl[aircraft_application %in% top_application]) + 
    geom_bar(aes(x = aircraft_application, y = pct, fill = milservice)
             , position = position_stack(), stat = "identity") + 
    coord_flip()

```


What's the use of different aircrafts over time?

ATTACK is use more and more, indicating more precise bombing missions. Pure fighter aircrafts used less or were adapted into fighter - bomber roles because by this time dogfighting (air-to-air combat) were fallen out of favor in the U.S. This is due their belief that missiles were all they needed to shoot down Soviet's heavy bombers. (Official dogfight training only returned by 1969 with the TOPGUN program.) 

```{r}

aircraft_app_time = thunder[!is.na(aircraft_application), .(
    count = .N
    , total_tonnage = sum(delivered_tonnage)
    ), by = .(aircraft_application, msnym)][order(-count)]


ap = ggplot(aircraft_app_time) + 
    geom_line(aes(x = msnym, y = total_tonnage, group = aircraft_application, color = aircraft_application))

ggplotly(ap)

```

Which aircrafts were used most?

```{r}
aircraft_use_overall = thunder[!is.na(aircraft_root), .(
    sortie_count = .N
    , total_delivered = sum(delivered_tonnage)
), by = .(aircraft_root)][order(-sortie_count)]

top_aircrafts = aircraft_use_overall$aircraft_root[1:6] 

ggplot(aircraft_use_overall[1:10]) + 
    geom_bar(aes(x = reorder(aircraft_root, sortie_count), y = sortie_count), stat = "identity") + 
    coord_flip()

```


Which aircraft were used in each application?

```{r}
aircraft_use_ttl = thunder[!is.na(aircraft_application), .(
    sortie_count = .N
    , total_delivered = sum(delivered_tonnage)
    , total_jettisoned = sum(jettisoned_tonnage)
    , total_returned = sum(returned_tonnage)
    
    ), by = .(aircraft_root, aircraft_type, aircraft_application)][order(aircraft_application, -sortie_count)]

top_aircrafts_app_app = aircraft_use_ttl[, head(.SD, 2), by = .(aircraft_application)]
top_aircrafts_app[, ttl_count := sum(sortie_count), by = .(aircraft_application)]
top_aircrafts_app[, aircraft_application := reorder(aircraft_application, -ttl_count)]

top_aircrafts_app = top_aircrafts_app[order(aircraft_application, -sortie_count)]

top_aircrafts_app[, rank := seq_along(aircraft_application)]

ggplot(top_aircrafts_app[aircraft_application %in% top_application]) + 
    geom_bar(aes(x = reorder(aircraft_root, rank), y = sortie_count, fill = aircraft_application), stat = "identity")

```


## Fighter - bomber

The F4 and F105 were used mainly by U.S. Air Force, while the F4 were also used by U.S. Navy and Marine Corp.

```{r}
aircraft_use_service = thunder[!is.na(milservice) & !is.na(aircraft_root), .(
    sortie_count = .N
    , total_delivered = sum(delivered_tonnage)
    , total_jettisoned = sum(jettisoned_tonnage)
    , total_returned = sum(returned_tonnage)
    ), by = .(aircraft_root, aircraft_application, milservice)]

aircraft_use_service[, total_sortie := sum(sortie_count), by = .(aircraft_root)]
aircraft_use_service[, use_pct := sortie_count / total_sortie]

ggplot(aircraft_use_service[aircraft_root %in% top_aircrafts_app$aircraft_root & aircraft_application == "FIGHTER, BOMBER"]) + 
    geom_bar(aes(x = aircraft_root, y = use_pct, fill = milservice), stat = "identity", position = position_stack()) 

```

We can only see the F-4's growing usage over time. 

According to Wikipedia, "It (F-4) served as the principal air superiority fighter for the U.S. Air Force, Navy, and Marine Corps and became important in the ground-attack and aerial reconnaissance roles late in the war". U.S. Navy were mainly responsible for the development of this aircraft and then distributed it to the USAF and USMC with great expectation about its performance.

Meanwhile, the F-105 was later removed from combat due to high loss rates.


```{r}
aircraft_use_time_service = thunder[, .(
    sortie_count = .N
    , total_delivered = sum(delivered_tonnage)
    , total_jettisoned = sum(jettisoned_tonnage)
    , total_returned = sum(returned_tonnage)
    , mission_count = uniqueN(missionid)
    ), by = .(aircraft_root, aircraft_application, milservice, msnym)]

ggplot(aircraft_use_time_service[aircraft_root %in% c("F105", "F4") & milservice %in% c("USAF", "USMC", "USN")]) + 
    geom_line(aes(x = msnym, y = sortie_count, col = aircraft_root)) + 
    facet_wrap(~milservice, scales = "free", nrow = 3)

```

## Fighter & carrier fighter

Mostly used by U.S. Navy


```{r}
ggplot(aircraft_use_service[aircraft_root %in% top_aircrafts_app$aircraft_root & aircraft_application %in% c("FIGHTER", "CARRIER, FIGHTER")]) + 
    geom_bar(aes(x = aircraft_root, y = use_pct, fill = milservice), stat = "identity", position = position_stack()) 

```



```{r}
ggplot(aircraft_use_time_service[aircraft_root %in% c("A1", "A4", "F8") & milservice %in% c("USAF", "USMC", "USN", "VNAF")]) + 
    geom_line(aes(x = msnym, y = sortie_count, col = aircraft_root)) + 
    facet_wrap(~milservice, scales = "free", nrow = 3)
```


# Aircrafts used on each mission type

A4, F4 and F105 assumes at least dual roles. How are the roles changed over time?

```{r}
aircraft_mfunc = thunder[!is.na(aircraft_root) & !is.na(mfunc_desc), .(
    sortie_count = .N
    , total_delivered = sum(delivered_tonnage)
), by = .(mfunc_desc, aircraft_root)][order(mfunc_desc, -sortie_count)]

aircraft_mfunc_top = aircraft_mfunc[mfunc_desc %in% c("ARMED RECCE", "STRIKE")]
aircraft_mfunc_top[, total_ac_sortie := sum(sortie_count), by = .(aircraft_root)]


ggplot(aircraft_mfunc_top[aircraft_root %in% top_aircrafts]) + 
    geom_bar(aes(x = reorder(aircraft_root, -total_ac_sortie), y = sortie_count, fill = mfunc_desc), stat = "identity", show.legend = T)

```

The A-1 Skyraider was an attack aircraft that was transfered to RVNAF and remained as its  "close air support workhorse" for much of the Vietnam War.

The use of A-1 gradually decreased over time as it was to be replace by the A-6A Intruder as part of the general switch to jet aircraft.
F-105 initally was used most for armed recconaisance missions, but its role was changed to mostly strike missions in the later years. Meanwhile, the F-4 Phantom remained quite active in both roles probably due to its superior qualities.

```{r, fig.height=15, fig.width=20}
aircraft_mfunc_time = thunder[!is.na(aircraft_root) & !is.na(mfunc_desc), .(
    sortie_count = .N
    , total_delivered = sum(delivered_tonnage)
), by = .(mfunc_desc, aircraft_root, msnym)]

ggplot(aircraft_mfunc_time[aircraft_root %in% top_aircrafts & mfunc_desc %in% c("STRIKE", "ARMED RECCE")]) + 
    geom_line(aes(x = msnym, y = sortie_count, color = mfunc_desc), stat = "identity") + 
    facet_wrap(~aircraft_root, ncol = 2, scales = "free")

```

# Target types

```{r}
target_aggr = thunder[!is.na(tgttype), .(
    sortie_count = .N
    , total_delivered = sum(delivered_tonnage)
), by = .(tgttype)][order(-total_delivered)]

top_targets = target_aggr$tgttype[1:5]

pol_targets = c("TANK (POL)", "DRUM (POL)", "BUNKER FACILITY (POL)", "REFINERY (POL)")

ggplot(target_aggr[1:15]) + 
    geom_bar(aes(x = reorder(tgttype, total_delivered), y = total_delivered), stat = "identity") + 
    coord_flip()

```

Motor vehicles were target more in the final stage of the operation - this probably correspond with the U.S. effort to cut the support line from the North to the South. 

```{r, fig.height=15, fig.width=7}

target_time = thunder[!is.na(tgttype), .(
    sortie_count = .N
    , total_delivered = sum(delivered_tonnage)
), by = .(tgttype, msnym)]

ggplot(target_time[tgttype %in% top_targets]) + 
    geom_line(aes(x = msnym, y = total_delivered, color = tgttype), stat = "identity") + 
    facet_wrap(~tgttype, nrow = length(top_targets), scales = "free")

```

Regrettably we do not have data of 1965, but we can still see POL targets were bombed with much higher intensity at the beginning but then went out of focus. According to Wikipedia:

*On 29 June 1965, airstrikes against the North's petroleum, oil, and lubricants (POL) storage areas were finally authorized by Johnson. Howerver, North Vietnam's army anticipated this move and spread their POL reservoir across the whole country. By 4 September 1965, POL strikes was halted as U.S. intelligence realized that the North suffered no POL shortage.*


```{r, fig.height=10, fig.width=7}

ggplot(target_time[tgttype %in% pol_targets]) + 
    geom_line(aes(x = msnym, y = total_delivered, color = tgttype), stat = "identity") + 
    facet_wrap(~tgttype, nrow = length(top_targets), scales = "free")

```


# Outcome of the war

In short, Rolling Thunder operation was not successful at what it set out to do due to the nature of the operation, as well as the U.S.' over confidence.

With the slow escalation of war, the Vietnamese army had time to adapt to the U.S. new strategies. Vietnamese signals intelligence staff of 5,000 were also "proved adept at exploiting traffic analysis as NSA was", when they deduced that before every bombing mission had an upsurge of traffic involving logistics and recon flights. Interestingly, they were also able to intercept U.S. radio communication, which used unencrypted voice. This is a major source of early warning for the Vietnamese army. :

*"...captured documents showed that the North Vietnamese had at least thirty to forty-five minutes' warning of 80 to 90 per cent of Rolling Thunder missions."* 

This severe security problem were not unknown to the U.S. Air Force, but they underestimated Vietnamese army's intelligence capabilities and ignored NSA's request to install voice encryption on aircrafts.

The lack of night-bombing capabilities and all-weather aircrafts also limits their attacks to day time, which made it easier for Vietnamese army to cope with.


```{r}
mfunc_hour = thunder[!is.na(mfunc_desc) & !is.na(atk_hour), .(
    sortie_count = .N
    , total_delivered = sum(delivered_tonnage)
    , mission_count = uniqueN(missionid)
), by = .(mfunc_desc, atk_hour)]


ggplot(mfunc_hour[atk_hour > 0 & mfunc_desc %in% c("STRIKE", "ARMED RECCE")]) + 
    geom_line(aes(x = atk_hour, y = sortie_count, col = mfunc_desc), stat = "identity")

```

That's the end of the Vietnam Bombing series. Future articles will have more light-hearted topics. Till next time!


